Hello! I'm having some trouble with certificates. Here is my position:
I have a nodejs environment that consists on:
1 - A websocket server, running with "express" and using "websocket". It is a websocket;
2 - A simple nextjs server, it just connects to the websocket server, listens to the traffic and execute changes based on incoming websocket messages.

This second server will NOT be exposed to the internet so it does not matter if the connection is secure or not because it will only be shown to te server.
The first server, well, this is being exposed with NGROK. But this info is not important since my problem occurs even when I try to connect via wss://localhost:3001

The problem:
Well, I wanted to make this websocket server a little more secure, so I decided to implement a ssl connection with certificates. I googled which was the best option to do that and I found this git repository: https://github.com/patrickpr/YAOG (PS: I know you can't access external links but since it is an old repository, maybe you have this page indexed inside your knowledge) and with this tool, I followed this tutorial: https://github.com/patrickpr/YAOG/blob/master/docs/10-full-example-1.md.

I generated all the certificates necessary and stored like this:

| -certificate
|   -CA
|     -ca_certificate.crt
|     -ca_key.pem
|   -SIGNED
|     -client_cert.crt
|     -client_key.pem
|     -client_signed.pfx
| -src
|   -websocket-server-ssl.js
|   -websocket-server.js
| -testSocket.bat
| -run.bat

Okay, a little context: from this link - https://github.com/patrickpr/YAOG/blob/master/docs/10-full-example-1.md - the generated files on topic "Generate the CA" are stored under 'CA -> ca_certificate.crt' and 'CA -> ca_key.pem' to the and they are the CA certificate files. For the sake of this example, let's say that I used the passphrase "my_ca_passphrase" to encrypt this ca_key.pem.

The other files inside "SIGNED" folder are from the same link, but generated following the topic "Generate a certificate to sign". I exported the client_cert.crt (certificate), the client_key.pem (key) and a signed certificate as well -> client_signed.pfx with the passphrase "my_client_passphrase".

Files inside the "src" folder are my code files. The "websocket-server-ssl.js" file is where my websocket with ssl runs and the "websocket-server.js" is used for testing purposes (without the ssl connection). It will NOT run with the application UNLESS I have to debug something other than the websocket connection.
The "websocket-server-ssl.js" its being started with this code:
const app = express();
const serverOptions = {
  key: fs.readFileSync(process.env.CERT_KEY_PATH),
  cert: fs.readFileSync(process.env.CERT_PATH),
  passphrase: process.env.CERT_CA_PASSPHRASE,
  requestCert: true, // Require client certificate
  rejectUnauthorized: true // Reject connections if client certificate is invalid
};
const server = https.createServer(serverOptions, app);
const wss = new WebSocket.Server({ server });

The vars:
process.env.CERT_KEY_PATH -> refers to "ca_key.pem" inside the "CA" folder.
process.env.CERT_PATH -> refers to "ca_certificate.crt" inside the CA folder.
process.env.CERT_CA_PASSPHRASE -> is "my_ca_passphrase"

The "testSocket.bat" is some scripts that I developed for testing puposes and it goes something like this:
wscat -c wss://localhost:3001 -x "SOME_PAYLOAD" --ca ./certificate/SIGNED/client_cert.crt --key ./certificate/SIGNED/client_key.pem --passphrase my_client_passphrase

The "run.bat" file is only a "concurrently" node script:
concurrently "npm run dev" "node --openssl-legacy-provider src/websocket-server-ssl.js"
It runs both servers - websocket and the nextjs server.

My problem is that when I run the "testSocket.bat" command with cmd the return is:
$ wscat -c wss://localhost:3001 -x "SOME_PAYLOAD" --ca ./certificate/SIGNED/client_cert.crt --key ./certificate/SIGNED/client_key.pem --passphrase my_client_passphrase
self-signed certificate
>

And nothing happens. I don't know if the problem is because I didn't got it which certificate to use to start the server and send the request or if I coded something wrong or if my wscat command is wrong. Can you help me?

----------------------------------------------------


| -certificate
|   -CA
|     -ca_certificate.crt
|     -ca_key.pem
|   -SIGNED
|     -client_cert.crt
|     -client_key.pem
|     -client_signed.pfx